<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capacitor Auth Manager - Vanilla JS Example</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .user-info {
      background: #f0f0f0;
      padding: 20px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .user-info h2 {
      margin-top: 0;
    }
    .auth-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button.danger {
      background: #dc3545;
    }
    button.danger:hover {
      background: #c82333;
    }
    .loading {
      color: #666;
      font-style: italic;
    }
    .error {
      color: #dc3545;
      padding: 10px;
      background: #f8d7da;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .status {
      padding: 10px;
      background: #d4edda;
      border-radius: 4px;
      margin-bottom: 20px;
      color: #155724;
    }
    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Capacitor Auth Manager - Vanilla JS Example</h1>
    
    <div id="error" class="error hidden"></div>
    <div id="status" class="status hidden"></div>
    
    <div id="loading" class="loading">Initializing authentication...</div>
    
    <div id="authenticated" class="hidden">
      <div class="user-info">
        <h2>User Information</h2>
        <pre id="userInfo">Loading...</pre>
      </div>
      
      <button onclick="signOut()" class="danger">Sign Out</button>
    </div>
    
    <div id="unauthenticated" class="hidden">
      <h2>Sign In</h2>
      <p>Choose an authentication provider:</p>
      
      <div class="auth-buttons">
        <button onclick="signIn('google')">Sign in with Google</button>
        <button onclick="signIn('github')">Sign in with GitHub</button>
        <button onclick="signIn('facebook')">Sign in with Facebook</button>
        <button onclick="signIn('microsoft')">Sign in with Microsoft</button>
        <button onclick="signIn('apple')">Sign in with Apple</button>
      </div>
      
      <h3>Email Authentication</h3>
      <div style="margin-bottom: 20px;">
        <input type="email" id="email" placeholder="Enter your email" style="padding: 8px; width: 300px; margin-right: 10px;">
        <button onclick="sendMagicLink()">Send Magic Link</button>
      </div>
      
      <h3>Email/Password Authentication</h3>
      <div style="margin-bottom: 20px;">
        <input type="email" id="emailPassword" placeholder="Email" style="padding: 8px; width: 200px; margin-right: 10px;">
        <input type="password" id="password" placeholder="Password" style="padding: 8px; width: 200px; margin-right: 10px;">
        <button onclick="signInWithPassword()">Sign In</button>
        <button onclick="signUpWithPassword()">Sign Up</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Import from CDN or local build
    import { auth } from '../../dist/esm/index.js';
    
    // Make functions available globally
    window.auth = auth;
    window.signIn = signIn;
    window.signOut = signOut;
    window.sendMagicLink = sendMagicLink;
    window.signInWithPassword = signInWithPassword;
    window.signUpWithPassword = signUpWithPassword;
    
    // UI Elements
    const loadingEl = document.getElementById('loading');
    const authenticatedEl = document.getElementById('authenticated');
    const unauthenticatedEl = document.getElementById('unauthenticated');
    const userInfoEl = document.getElementById('userInfo');
    const errorEl = document.getElementById('error');
    const statusEl = document.getElementById('status');
    
    // Helper functions
    function showError(message) {
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
      setTimeout(() => errorEl.classList.add('hidden'), 5000);
    }
    
    function showStatus(message) {
      statusEl.textContent = message;
      statusEl.classList.remove('hidden');
      setTimeout(() => statusEl.classList.add('hidden'), 5000);
    }
    
    function updateUI(state) {
      loadingEl.classList.add('hidden');
      
      if (state.isAuthenticated && state.user) {
        authenticatedEl.classList.remove('hidden');
        unauthenticatedEl.classList.add('hidden');
        userInfoEl.textContent = JSON.stringify(state.user, null, 2);
      } else {
        authenticatedEl.classList.add('hidden');
        unauthenticatedEl.classList.remove('hidden');
      }
    }
    
    // Configure auth
    auth.configure({
      providers: {
        google: {
          clientId: import.meta.env.VITE_GOOGLE_CLIENT_ID || 'your-google-client-id'
        },
        github: {
          clientId: import.meta.env.VITE_GITHUB_CLIENT_ID || 'your-github-client-id'
        },
        facebook: {
          appId: import.meta.env.VITE_FACEBOOK_APP_ID || 'your-facebook-app-id'
        },
        microsoft: {
          clientId: import.meta.env.VITE_MICROSOFT_CLIENT_ID || 'your-microsoft-client-id'
        },
        apple: {
          clientId: import.meta.env.VITE_APPLE_CLIENT_ID || 'your-apple-client-id'
        }
      },
      persistence: 'local',
      enableLogging: true
    });
    
    // Subscribe to auth state changes
    auth.onAuthStateChange((state) => {
      console.log('Auth state changed:', state);
      updateUI(state);
    });
    
    // Auth functions
    async function signIn(provider) {
      try {
        showStatus(`Signing in with ${provider}...`);
        const result = await auth.signIn(provider);
        showStatus(`Successfully signed in with ${provider}!`);
        console.log('Sign in result:', result);
      } catch (error) {
        console.error('Sign in error:', error);
        showError(`Failed to sign in with ${provider}: ${error.message}`);
      }
    }
    
    async function signOut() {
      try {
        await auth.signOut();
        showStatus('Successfully signed out!');
      } catch (error) {
        console.error('Sign out error:', error);
        showError(`Failed to sign out: ${error.message}`);
      }
    }
    
    async function sendMagicLink() {
      const email = document.getElementById('email').value;
      if (!email) {
        showError('Please enter an email address');
        return;
      }
      
      try {
        showStatus('Sending magic link...');
        await auth.signIn('magic-link', { email });
        showStatus(`Magic link sent to ${email}! Check your inbox.`);
      } catch (error) {
        console.error('Magic link error:', error);
        showError(`Failed to send magic link: ${error.message}`);
      }
    }
    
    async function signInWithPassword() {
      const email = document.getElementById('emailPassword').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        showError('Please enter both email and password');
        return;
      }
      
      try {
        showStatus('Signing in...');
        await auth.signIn('email-password', { email, password });
        showStatus('Successfully signed in!');
      } catch (error) {
        console.error('Sign in error:', error);
        showError(`Failed to sign in: ${error.message}`);
      }
    }
    
    async function signUpWithPassword() {
      const email = document.getElementById('emailPassword').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        showError('Please enter both email and password');
        return;
      }
      
      try {
        showStatus('Creating account...');
        await auth.signUp({ email, password });
        showStatus('Account created successfully!');
      } catch (error) {
        console.error('Sign up error:', error);
        showError(`Failed to create account: ${error.message}`);
      }
    }
    
    // Initialize UI with current auth state
    updateUI(auth.getAuthState());
  </script>
</body>
</html>